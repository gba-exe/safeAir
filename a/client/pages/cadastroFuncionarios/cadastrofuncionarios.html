<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../../assets/logoClaro.jpeg" type="image/x-icon">
  <title>Cadastro de funcionários</title>
  <link rel="stylesheet" href="../../style/style.css">
  <link rel="stylesheet" href="../navbarFooter/navbar.css">
  <link rel="stylesheet" href="../navbarFooter/footer.css">
</head>

<body>
  <script src="../../assets/components/header.js"></script>
  <div class="divContainer">
    <div class="divEsquerda">
      <div class="divContent">
        <a class="pPequeno" href="../home/home.html">
          < Voltar a home </a>
            <div id="divTexto">
              <h1>Cadastre-se já!</h1>
              <div>
                <p class="pParagrafo">&emsp;&emsp;Faça o cadastro de novos usuários para que eles tenham acesso a seu
                  Dashboard sem utilizar seu login.</p>
              </div>
            </div>
      </div>
    </div>
    <div class="divDireita">
      <div class="divContent">
        <p class="pInput">Nome Completo:</p>
        <input id="iptNome" placeholder="Nome">
        <p class="pInput">E-mail:</p>
        <input id="iptEmail" placeholder="E-mail">
        <p class="pInput">Senha:</p>
        <input id="iptSenha" placeholder="Senha">
        <p class="pInput">Confirmação de senha:</p>
        <input id="iptConfirmacao" placeholder="Confirmação de senha">
        <label class="pInput" for="chkAdministrador">Administrador?</label>
        <input type="checkbox" id="chkAdministrador" name="checkbox" value="1">
        <p class="pInput">Empresa:</p>
        <input id="iptEmpresa" placeholder="Nome da Empresa">
        <br>
        <button onclick="criar()" class="btnVerde">Criar Conta</button>
      </div>
    </div>
  </div>
  <script src="../../assets/components/footer.js"></script>

</body>

</html>

<script>
  function criar() {
    var erro = false;
    var nomeFuncionarioVar = iptNome.value;
    var emailFuncionarioVar = iptEmail.value;
    var senhaFuncionarioVar = iptSenha.value;
    var confSenhaFuncionarioVar = iptConfirmacao.value;
    var admVar = chkAdministrador.value;
    var nomeEmpresaVar = iptEmpresa.value;

    iptNome.style = "border-color: #072953;";
    iptEmail.style = "border-color: #072953;";
    iptTelefone.style = "border-color: #072953;";
    iptSenha.style = "border-color: #072953;";
    iptConfirmacao.style = "border-color: #072953;";
    iptEmpresa.style = "border-color: #072953"


    if (nomeFuncionarioVar == '') {
      alert("Favor informar o nome do cliente.");
      iptNome.style = "border-color: red;";
      erro = true;
    }

    if (emailFuncionarioVar.indexOf('@')) {
      alert("Favor informar corretamente o email do cliente.");
      iptEmail.style = "border-color: red;";
      erro = true;
    }

    if (senhaFuncionarioVar == '') {
      alert("Favor informar a senha do cliente.");
      iptSenha.style = "border-color: red;";
      erro = true;
    }

    if (confSenhaFuncionarioVar == '') {
      alert("Favor informar corretamente a senha do cliente.");
      iptConfirmacao.style = "border-color: red;";
      erro = true;
    } else if (confSenhaFuncionarioVar != senhaFuncionarioVar) {
      alert("As senhas não estão idênticas.");
      iptSenha.style = "border-color: red;";
      iptConfirmacao.style = "border-color: red;";
      erro = true;
    }

    if (nomeEmpresaVar == '') {
      alert("Favor informar o nome da empresa em que trabalha.")
      iptEmpresa.style = "border-color: red;"
      erro = true;
    }

    function cadastrar() {
      aguardar();

      //Recupere o valor da nova input pelo nome do id
      // Agora vá para o método fetch logo abaixo

      // if (nomeVar == "" || emailVar == "" || senhaVar == "" || confirmacaoSenhaVar == "") {
      //   cardErro.style.display = "block"
      //   mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";

      // finalizarAguardar();
      //   return false;
      // }
      // else {
      //   setInterval(sumirMensagem, 5000)
      // }

      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          nomeServer: nomeFuncionarioVar,
          emailServer: emailFuncionarioVar,
          senhaServer: senhaFuncionarioVar,
          admServer: admVar,
          empresaServer: nomeEmpresaVar
        })
      }).then(function (resposta) {

        console.log("resposta: ", resposta);

        if (resposta.ok) {
          alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...")

          // cardErro.style.display = "block";

          // mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000")

          limparFormulario();
          finalizarAguardar();
        } else {
          throw ("Houve um erro ao tentar realizar o cadastro!");
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

      return false;
    }

  }
</script>